var:
  app_version: x.y.z
  app_name: drawio
  environment: prod
  team: skynet
  registry: registry.cowbell.realestate.com.au
app:
  image: <(var.registry)>/<(var.team)>/draw.io:<(var.app_version)>
  ports: 
    - "8080:8080"
  environment:
    CLIENT_URL: 'https://git.realestate.com.au/login/oauth/access_token'
    KMS_ENCRYPTED_CLIENT_SECRET: 'AQICAHgByKVTufNQVdpIELtHsZJtTPJhS6YWCiDD0FQgj9i/SgGbp79Lzhk/fnF4vj3s3de9AAAAhzCBhAYJKoZIhvcNAQcGoHcwdQIBADBwBgkqhkiG9w0BBwEwHgYJYIZIAWUDBAEuMBEEDEgR40TcetwtdcodhQIBEIBDwSyCS2y47L1U7SiX+oW/KiMhFL6x+L8ERptapxD3jnrfctv+9Yu1rboqssU+dnJ1MrSaFnsLVNmbyogZEQZfeITf9g=='
  health_check:
    protocol: http
    port: 8080
    path: '/'
  name: <(var.app_name)>

web:
  image: null

aws:
  region: ap-southeast-2
  instances:
    type: t2.small
    min: 1
    max: 1
    ami_flavour: rea-centos
    key_pair: gia-services-ap-southeast-2
    ports:
      22:
        allow_ingress_from:
          - "10.0.0.0/8"
          - "172.16.0.0/12"
          - "192.168.0.0/16"
    subnets:
      - subnet-1705ce72
      - subnet-61a85816

  load_balancer:
    scheme: "internet-facing"
    listeners:
      443:
        to: 8080
        protocol: HTTPS
        ssl_certificate: "arn:aws:acm:ap-southeast-2:351016140122:certificate/9639ca8e-c0ae-4e5d-b0a8-4503e2c1af5b"
    subnets:
     - subnet-1505ce70
     - subnet-60a85817
  auto_scaling:
    timeout: "PT1H"

  #cloud_watch:
  #  alarms:
  #    HealthyHostCount:
  #      when: "Minimum AWS/ELB/HealthyHostCount < 1"
  #      period: 120
  #      times: 5
  #      notify_on:
  #        - alarm
  #        - ok
  #      notify:
  #        - https://events.pagerduty.com/integration/XX768a7d06871f47f283fd40cdc1b1203c/enqueue
  kms:
    key: "arn:aws:kms:ap-southeast-2:351016140122:key/0fc418c5-8c3d-4f02-aa39-0a9805a6714e"
  vpc: vpc-e958a48c
  route53:
    zone: skynet.realestate.com.au
  tags:
    application: <(var.app_name)>
    contact: global-infrastructure@rea-group.com
    costcode: '456'
    lob: GIA

docker:
  registries:
    registry.cowbell.realestate.com.au:
      auth: s3://rea-slips-ap-southeast-2/351016140122/root/registry.cowbell.realestate.com.au

splunk:
  index: skynet
  host: skynet-prod-splunk-forwarder.skynet.realestate.com.au

